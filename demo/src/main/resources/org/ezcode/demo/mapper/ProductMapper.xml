<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.ezcode.demo.mapper.ProductMapper">
<select id="selectAll" resultMap="listMap">
  SELECT 
  p.pno, p.pname, p.price, p.seller, p.summary, p.regdate, p.hit, p.state, p.ctno,
  r.rvno, r.uid, r.content, r.writer, ifnull(round(avg(r.score), 1), 0) ravg, r.regdate, count(r.rvno) rcnt
  FROM 
  tbl_review r right outer join tbl_product p
  on r.pno = p.pno
  group by pno
  order by pno desc
  limit #{skip}, #{amount}
</select>

<resultMap type="org.ezcode.demo.domain.ProductVO" id="listMap">
  <id column="pno" property="pno"/>
  <result column="pno" property="pno"/>
  <result column="pname" property="pname"/>
  <result column="price" property="price"/>
  <result column="seller" property="seller"/>
  <result column="summary" property="summary"/>
  <result column="regdate" property="regdate"/>
  <result column="hit" property="hit"/>
  <result column="state" property="state"/>
  <result column="ctno" property="ctno"/>
  <collection property="review" resultMap="reviewMap"></collection>
</resultMap>

<resultMap type="org.ezcode.demo.domain.ReviewVO" id="reviewMap">
	<result column="rvno" property="rvno"/>
	<result column="uid" property="uid"/>
	<result column="content" property="content"/>
	<result column="ravg" property="ravg"/>
	<result column="regdate" property="regdate"/>
	<result column="rcnt" property="rcnt"/>
</resultMap>

<select id="getCount" resultType="int">
    select 
    count(*)
    from
    tbl_product
    where pno > 0
</select>
</mapper>